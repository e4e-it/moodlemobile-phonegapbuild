{"version":3,"sources":["../../src/addon/mod/chat/pages/chat/chat.module.ts","../../src/addon/mod/chat/pages/chat/chat.ts"],"names":[],"mappings":"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","file":"95.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CoreComponentsModule } from '@components/components.module';\r\nimport { CoreDirectivesModule } from '@directives/directives.module';\r\nimport { CorePipesModule } from '@pipes/pipes.module';\r\nimport { AddonModChatChatPage } from './chat';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        AddonModChatChatPage,\r\n    ],\r\n    imports: [\r\n        CoreComponentsModule,\r\n        CoreDirectivesModule,\r\n        CorePipesModule,\r\n        IonicPageModule.forChild(AddonModChatChatPage),\r\n        TranslateModule.forChild()\r\n    ],\r\n})\r\nexport class AddonModChatChatPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/chat/pages/chat/chat.module.ts","// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component, ViewChild, NgZone } from '@angular/core';\r\nimport { Content, IonicPage, ModalController, NavController, NavParams } from 'ionic-angular';\r\nimport { CoreAppProvider } from '@providers/app';\r\nimport { CoreEventsProvider } from '@providers/events';\r\nimport { CoreLoggerProvider } from '@providers/logger';\r\nimport { CoreSitesProvider } from '@providers/sites';\r\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\r\nimport { CoreTextUtilsProvider } from '@providers/utils/text';\r\nimport { AddonModChatProvider } from '../../providers/chat';\r\nimport { Network } from '@ionic-native/network';\r\nimport * as moment from 'moment';\r\n\r\n/**\r\n * Page that displays a chat session.\r\n */\r\n@IonicPage({ segment: 'addon-mod-chat-chat' })\r\n@Component({\r\n    selector: 'page-addon-mod-chat-chat',\r\n    templateUrl: 'chat.html',\r\n})\r\nexport class AddonModChatChatPage {\r\n    @ViewChild(Content) content: Content;\r\n\r\n    loaded = false;\r\n    title: string;\r\n    messages = [];\r\n    newMessage: string;\r\n    polling: any;\r\n    isOnline: boolean;\r\n    currentUserBeep: string;\r\n\r\n    protected logger;\r\n    protected courseId: number;\r\n    protected chatId: number;\r\n    protected sessionId: number;\r\n    protected lastTime = 0;\r\n    protected oldContentHeight = 0;\r\n    protected onlineObserver: any;\r\n    protected keyboardObserver: any;\r\n    protected viewDestroyed = false;\r\n    protected pollingRunning = false;\r\n\r\n    constructor(navParams: NavParams, logger: CoreLoggerProvider, network: Network,  zone: NgZone, private navCtrl: NavController,\r\n            private chatProvider: AddonModChatProvider, private appProvider: CoreAppProvider, sitesProvider: CoreSitesProvider,\r\n            private modalCtrl: ModalController, private domUtils: CoreDomUtilsProvider, private textUtils: CoreTextUtilsProvider,\r\n            private eventsProvider: CoreEventsProvider) {\r\n\r\n        this.chatId = navParams.get('chatId');\r\n        this.courseId = navParams.get('courseId');\r\n        this.title = navParams.get('title');\r\n        this.logger = logger.getInstance('AddonModChoiceChoicePage');\r\n        this.currentUserBeep = 'beep ' + sitesProvider.getCurrentSiteUserId();\r\n        this.isOnline = this.appProvider.isOnline();\r\n        this.onlineObserver = network.onchange().subscribe((online) => {\r\n            // Execute the callback in the Angular zone, so change detection doesn't stop working.\r\n            zone.run(() => {\r\n                this.isOnline = this.appProvider.isOnline();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * View loaded.\r\n     */\r\n    ionViewDidLoad(): void {\r\n        this.loginUser().then(() => {\r\n            return this.fetchMessages().then(() => {\r\n                this.startPolling();\r\n            }).catch((error) => {\r\n                this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhileretrievingmessages', true);\r\n                this.navCtrl.pop();\r\n            });\r\n        }).catch((error) => {\r\n            this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhileconnecting', true);\r\n            this.navCtrl.pop();\r\n        }).finally(() => {\r\n            this.loaded = true;\r\n        });\r\n\r\n        // Recalculate footer position when keyboard is shown or hidden.\r\n        this.keyboardObserver = this.eventsProvider.on(CoreEventsProvider.KEYBOARD_CHANGE, (kbHeight) => {\r\n            this.content.resize();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Runs when the page has fully entered and is now the active page.\r\n     * This event will fire, whether it was the first load or a cached page.\r\n     */\r\n    ionViewDidEnter(): void {\r\n        this.startPolling();\r\n    }\r\n\r\n    /**\r\n     * Runs when the page is about to leave and no longer be the active page.\r\n     */\r\n    ionViewWillLeave(): void {\r\n        this.stopPolling();\r\n    }\r\n\r\n    /**\r\n     * Display the chat users modal.\r\n     */\r\n    showChatUsers(): void {\r\n        const modal = this.modalCtrl.create('AddonModChatUsersPage', {sessionId: this.sessionId});\r\n        modal.onDidDismiss((data) => {\r\n            if (data && data.talkTo) {\r\n                this.newMessage = `To ${data.talkTo}: `;\r\n            }\r\n            if (data && data.beepTo) {\r\n                this.sendMessage('', data.beepTo);\r\n            }\r\n        });\r\n        modal.present();\r\n    }\r\n\r\n    /**\r\n     * Convenience function to login the user.\r\n     *\r\n     * @return {Promise<any>} Resolved when done.\r\n     */\r\n    protected loginUser(): Promise<any> {\r\n        return this.chatProvider.loginUser(this.chatId).then((sessionId) => {\r\n            this.sessionId = sessionId;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Convenience function to fetch chat messages.\r\n     *\r\n     * @return {Promise<any>} Promise resolved when done.\r\n     */\r\n    protected fetchMessages(): Promise<any> {\r\n        return this.chatProvider.getLatestMessages(this.sessionId, this.lastTime).then((messagesInfo) => {\r\n            this.lastTime = messagesInfo.chatnewlasttime || 0;\r\n\r\n            return this.chatProvider.getMessagesUserData(messagesInfo.messages, this.courseId).then((messages) => {\r\n                this.messages = this.messages.concat(messages);\r\n                if (messages.length) {\r\n                    // New messages or beeps, scroll to bottom.\r\n                    setTimeout(() => this.scrollToBottom());\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Start the polling to get chat messages periodically.\r\n     */\r\n    protected startPolling(): void {\r\n        // We already have the polling in place.\r\n        if (this.polling) {\r\n            return;\r\n        }\r\n\r\n        // Start polling.\r\n        this.polling = setInterval(() => {\r\n            this.fetchMessagesInterval().catch(() => {\r\n                // Ignore errors.\r\n            });\r\n        }, AddonModChatProvider.POLL_INTERVAL);\r\n    }\r\n\r\n    /**\r\n     * Stop polling for messages.\r\n     */\r\n    protected stopPolling(): void {\r\n        if (this.polling) {\r\n            this.logger.debug('Cancelling polling for messages');\r\n            clearInterval(this.polling);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convenience function to be called every certain time to fetch chat messages.\r\n     *\r\n     * @return {Promise<any>} Promised resolved when done.\r\n     */\r\n    protected fetchMessagesInterval(): Promise<any> {\r\n        this.logger.debug('Polling for messages');\r\n        if (!this.isOnline || this.pollingRunning) {\r\n            // Obviously we cannot check for new messages when the app is offline.\r\n            return Promise.reject(null);\r\n        }\r\n\r\n        this.pollingRunning = true;\r\n\r\n        return this.fetchMessages().catch(() => {\r\n            // Try to login, it might have failed because the session expired.\r\n            return this.loginUser().then(() => {\r\n                return this.fetchMessages();\r\n            }).catch((error) => {\r\n                // Fail again. Stop polling if needed.\r\n                if (this.polling) {\r\n                    clearInterval(this.polling);\r\n                    this.polling = undefined;\r\n                }\r\n                this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhileretrievingmessages', true);\r\n\r\n                return Promise.reject(null);\r\n            });\r\n        }).finally(() => {\r\n            this.pollingRunning = false;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if the date should be displayed between messages (when the day changes at midnight for example).\r\n     *\r\n     * @param  {any} message     New message object.\r\n     * @param  {any} prevMessage Previous message object.\r\n     * @return {boolean} True if messages are from diferent days, false othetwise.\r\n     */\r\n    showDate(message: any, prevMessage: any): boolean {\r\n        if (!prevMessage) {\r\n            return true;\r\n        }\r\n\r\n        // Check if day has changed.\r\n        return !moment(message.timestamp * 1000).isSame(prevMessage.timestamp * 1000, 'day');\r\n    }\r\n\r\n    /**\r\n     * Send a message to the chat.\r\n     *\r\n     * @param {string} text     Text of the nessage.\r\n     * @param {number} [beep=0] ID of the user to beep.\r\n     */\r\n    sendMessage(text: string, beep: number = 0): void {\r\n        if (!this.isOnline) {\r\n            // Silent error, the view should prevent this.\r\n            return;\r\n        } else if (beep === 0 && !text.trim()) {\r\n            // Silent error.\r\n            return;\r\n        }\r\n        text = this.textUtils.replaceNewLines(text, '<br>');\r\n\r\n        const modal = this.domUtils.showModalLoading('core.sending', true);\r\n        this.chatProvider.sendMessage(this.sessionId, text, beep).then(() => {\r\n            // Update messages to show the sent message.\r\n            this.fetchMessagesInterval().catch(() => {\r\n                // Ignore errors.\r\n            });\r\n        }).catch((error) => {\r\n            /* Only close the keyboard if an error happens, we want the user to be able to send multiple\r\n              messages without the keyboard being closed. */\r\n            this.appProvider.closeKeyboard();\r\n\r\n            this.domUtils.showErrorModalDefault(error, 'addon.mod_chat.errorwhilesendingmessage', true);\r\n        }).finally(() => {\r\n            modal.dismiss();\r\n        });\r\n    }\r\n\r\n    reconnect(): Promise<any> {\r\n        const modal = this.domUtils.showModalLoading();\r\n\r\n        // Call startPolling would take a while for the first execution, so we'll execute it manually to check if it works now.\r\n        return this.fetchMessagesInterval().then(() => {\r\n            // It works, start the polling again.\r\n            this.startPolling();\r\n        }).catch(() => {\r\n            // Ignore errors.\r\n        }).finally(() => {\r\n            modal.dismiss();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Scroll bottom when render has finished.\r\n     */\r\n    scrollToBottom(): void {\r\n        // Need a timeout to leave time to the view to be rendered.\r\n        setTimeout(() => {\r\n            if (!this.viewDestroyed) {\r\n                this.domUtils.scrollToBottom(this.content, 0);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Content or scroll has been resized. For content, only call it if it's been added on top.\r\n     */\r\n    resizeContent(): void {\r\n        let top = this.content.getContentDimensions().scrollTop;\r\n        this.content.resize();\r\n\r\n        // Wait for new content height to be calculated.\r\n        setTimeout(() => {\r\n            // Visible content size changed, maintain the bottom position.\r\n            if (!this.viewDestroyed && this.content && this.domUtils.getContentHeight(this.content) != this.oldContentHeight) {\r\n                if (!top) {\r\n                    top = this.content.getContentDimensions().scrollTop;\r\n                }\r\n\r\n                top += this.oldContentHeight - this.domUtils.getContentHeight(this.content);\r\n                this.oldContentHeight = this.domUtils.getContentHeight(this.content);\r\n\r\n                this.content.scrollTo(0, top, 0);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Page destroyed.\r\n     */\r\n    ngOnDestroy(): void {\r\n        this.onlineObserver && this.onlineObserver.unsubscribe();\r\n        this.keyboardObserver && this.keyboardObserver.off();\r\n        this.stopPolling();\r\n        this.viewDestroyed = true;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/chat/pages/chat/chat.ts"],"sourceRoot":""}