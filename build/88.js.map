{"version":3,"sources":["../../src/addon/mod/data/pages/search/search.module.ts","../../src/addon/mod/data/pages/search/search.ts"],"names":[],"mappings":"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","file":"88.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CoreDirectivesModule } from '@directives/directives.module';\r\nimport { AddonModDataComponentsModule } from '../../components/components.module';\r\nimport { AddonModDataSearchPage } from './search';\r\nimport { CoreCompileHtmlComponentModule } from '@core/compile/components/compile-html/compile-html.module';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        AddonModDataSearchPage,\r\n    ],\r\n    imports: [\r\n        CoreDirectivesModule,\r\n        AddonModDataComponentsModule,\r\n        CoreCompileHtmlComponentModule,\r\n        IonicPageModule.forChild(AddonModDataSearchPage),\r\n        TranslateModule.forChild()\r\n    ],\r\n})\r\nexport class AddonModDataSearchPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/data/pages/search/search.module.ts","// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage, NavParams, ViewController } from 'ionic-angular';\r\nimport { FormBuilder, FormGroup } from '@angular/forms';\r\nimport { CoreUtilsProvider } from '@providers/utils/utils';\r\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\r\nimport { CoreTextUtilsProvider } from '@providers/utils/text';\r\nimport { AddonModDataComponentsModule } from '../../components/components.module';\r\nimport { AddonModDataFieldsDelegate } from '../../providers/fields-delegate';\r\n\r\n/**\r\n * Page that displays the search modal.\r\n */\r\n@IonicPage({ segment: 'addon-mod-data-search' })\r\n@Component({\r\n    selector: 'page-addon-mod-data-search',\r\n    templateUrl: 'search.html',\r\n})\r\nexport class AddonModDataSearchPage {\r\n    search: any;\r\n    fields: any;\r\n    data: any;\r\n    advancedSearch: any;\r\n    extraImports = [AddonModDataComponentsModule];\r\n    searchForm: FormGroup;\r\n    jsData: any;\r\n    fieldsArray: any;\r\n\r\n    constructor(params: NavParams, private viewCtrl: ViewController, fb: FormBuilder, protected utils: CoreUtilsProvider,\r\n            protected domUtils: CoreDomUtilsProvider, protected fieldsDelegate: AddonModDataFieldsDelegate,\r\n            protected textUtils: CoreTextUtilsProvider) {\r\n        this.search = params.get('search');\r\n        this.fields = params.get('fields');\r\n        this.data = params.get('data');\r\n\r\n        const advanced = {};\r\n        if (typeof this.search.advanced == 'object') {\r\n            Object.keys(this.search.advanced).forEach((index) => {\r\n                if (typeof this.search.advanced[index] != 'undefined' && typeof this.search.advanced[index].name != 'undefined') {\r\n                    advanced[this.search.advanced[index].name] = this.search.advanced[index].value ?\r\n                        this.textUtils.parseJSON(this.search.advanced[index].value) : '';\r\n                } else {\r\n                    advanced[index] = this.search.advanced[index] ?\r\n                        this.textUtils.parseJSON(this.search.advanced[index]) : '';\r\n                }\r\n            });\r\n        } else {\r\n            this.search.advanced.forEach((field) => {\r\n                advanced[field.name] = field.value ? this.textUtils.parseJSON(field.value) : '';\r\n            });\r\n        }\r\n        this.search.advanced = advanced;\r\n\r\n        this.searchForm = fb.group({\r\n            text: [this.search.text],\r\n            sortBy: [this.search.sortBy || '0'],\r\n            sortDirection: [this.search.sortDirection || 'DESC'],\r\n            firstname: [this.search.advanced['firstname'] || ''],\r\n            lastname: [this.search.advanced['lastname'] || '']\r\n        });\r\n\r\n        this.fieldsArray = this.utils.objectToArray(this.fields);\r\n        this.advancedSearch = this.renderAdvancedSearchFields();\r\n    }\r\n\r\n    /**\r\n     * Displays Advanced Search Fields.\r\n     *\r\n     * @return {string}         Generated HTML.\r\n     */\r\n    protected renderAdvancedSearchFields(): string {\r\n        if (!this.data.asearchtemplate) {\r\n            return '';\r\n        }\r\n\r\n        this.jsData = {\r\n            fields: this.fields,\r\n            form: this.searchForm,\r\n            search: this.search.advanced\r\n        };\r\n\r\n        let template = this.data.asearchtemplate,\r\n            replace, render;\r\n\r\n        // Replace the fields found on template.\r\n        this.fieldsArray.forEach((field) => {\r\n            replace = '[[' + field.name + ']]';\r\n            replace = replace.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\r\n            replace = new RegExp(replace, 'gi');\r\n\r\n            // Replace field by a generic directive.\r\n            render = '<addon-mod-data-field-plugin mode=\"search\" [field]=\"fields[' + field.id +\r\n                ']\" [form]=\"form\" [search]=\"search\"></addon-mod-data-field-plugin>';\r\n            template = template.replace(replace, render);\r\n        });\r\n\r\n        // Not pluginable other search elements.\r\n        // Replace firstname field by the text input.\r\n        replace = new RegExp('##firstname##', 'gi');\r\n        render = '<span [formGroup]=\"form\"><ion-input type=\"text\" name=\"firstname\" \\\r\n        [placeholder]=\"\\'addon.mod_data.authorfirstname\\' | translate\" formControlName=\"firstname\"></ion-input></span>';\r\n        template = template.replace(replace, render);\r\n\r\n        // Replace lastname field by the text input.\r\n        replace = new RegExp('##lastname##', 'gi');\r\n        render = '<span [formGroup]=\"form\"><ion-input type=\"text\" name=\"lastname\" \\\r\n        [placeholder]=\"\\'addon.mod_data.authorlastname\\' | translate\" formControlName=\"lastname\"></ion-input></span>';\r\n        template = template.replace(replace, render);\r\n\r\n        return template;\r\n    }\r\n\r\n    /**\r\n     * Retrieve the entered data in search in a form.\r\n     *\r\n     * @param {any} searchedData Array with the entered form values.\r\n     * @return {any[]}          Array with the answers.\r\n     */\r\n    getSearchDataFromForm(searchedData: any): any[] {\r\n        const advancedSearch = [];\r\n\r\n        // Filter and translate fields to each field plugin.\r\n        this.fieldsArray.forEach((field) => {\r\n            const fieldData = this.fieldsDelegate.getFieldSearchData(field, searchedData);\r\n\r\n            if (fieldData) {\r\n                fieldData.forEach((data) => {\r\n                    data.value = JSON.stringify(data.value);\r\n                    // WS wants values in Json format.\r\n                    advancedSearch.push(data);\r\n                });\r\n            }\r\n        });\r\n\r\n        // Not pluginable other search elements.\r\n        if (searchedData['firstname']) {\r\n            // WS wants values in Json format.\r\n            advancedSearch.push({\r\n                name: 'firstname',\r\n                value: JSON.stringify(searchedData['firstname'])\r\n            });\r\n        }\r\n\r\n        if (searchedData['lastname']) {\r\n            // WS wants values in Json format.\r\n            advancedSearch.push({\r\n                name: 'lastname',\r\n                value: JSON.stringify(searchedData['lastname'])\r\n            });\r\n        }\r\n\r\n        return advancedSearch;\r\n    }\r\n\r\n    /**\r\n     * Close modal.\r\n     *\r\n     * @param {any} [data] Data to return to the page.\r\n     */\r\n    closeModal(data?: any): void {\r\n        this.viewCtrl.dismiss(data);\r\n    }\r\n\r\n    /**\r\n     * Toggles between advanced to normal search.\r\n     */\r\n    toggleAdvanced(): void {\r\n        this.search.searchingAdvanced = !this.search.searchingAdvanced;\r\n    }\r\n\r\n    /**\r\n     * Done editing.\r\n     */\r\n    searchEntries(): void {\r\n        const searchedData = this.searchForm.value;\r\n\r\n        if (this.search.searchingAdvanced) {\r\n            this.search.advanced = this.getSearchDataFromForm(searchedData);\r\n            this.search.searching = this.search.advanced.length > 0;\r\n        } else {\r\n            this.search.text = searchedData.text;\r\n            this.search.searching = this.search.text.length > 0;\r\n        }\r\n\r\n        this.search.sortBy = searchedData.sortBy;\r\n        this.search.sortDirection = searchedData.sortDirection;\r\n\r\n        this.closeModal(this.search);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/data/pages/search/search.ts"],"sourceRoot":""}