{"version":3,"sources":["../../src/addon/mod/quiz/pages/attempt/attempt.module.ts","../../src/addon/mod/quiz/pages/attempt/attempt.ts"],"names":[],"mappings":"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","file":"67.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CoreComponentsModule } from '@components/components.module';\r\nimport { CoreDirectivesModule } from '@directives/directives.module';\r\nimport { AddonModQuizAttemptPage } from './attempt';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        AddonModQuizAttemptPage,\r\n    ],\r\n    imports: [\r\n        CoreComponentsModule,\r\n        CoreDirectivesModule,\r\n        IonicPageModule.forChild(AddonModQuizAttemptPage),\r\n        TranslateModule.forChild()\r\n    ],\r\n})\r\nexport class AddonModQuizAttemptPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/quiz/pages/attempt/attempt.module.ts","// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { IonicPage, NavParams } from 'ionic-angular';\r\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\r\nimport { AddonModQuizProvider } from '../../providers/quiz';\r\nimport { AddonModQuizHelperProvider } from '../../providers/helper';\r\n\r\n/**\r\n * Page that displays some summary data about an attempt.\r\n */\r\n@IonicPage({ segment: 'addon-mod-quiz-attempt' })\r\n@Component({\r\n    selector: 'page-addon-mod-quiz-attempt',\r\n    templateUrl: 'attempt.html',\r\n})\r\nexport class AddonModQuizAttemptPage implements OnInit {\r\n    courseId: number; // The course ID the quiz belongs to.\r\n    quiz: any; // The quiz the attempt belongs to.\r\n    attempt: any; // The attempt to view.\r\n    component = AddonModQuizProvider.COMPONENT; // Component to link the files to.\r\n    componentId: number; // Component ID to use in conjunction with the component.\r\n    loaded: boolean; // Whether data has been loaded.\r\n\r\n    protected attemptId: number; // Attempt to view.\r\n    protected quizId: number; // ID of the quiz the attempt belongs to.\r\n\r\n    constructor(navParams: NavParams, protected domUtils: CoreDomUtilsProvider, protected quizProvider: AddonModQuizProvider,\r\n            protected quizHelper: AddonModQuizHelperProvider) {\r\n\r\n        this.attemptId = navParams.get('attemptId');\r\n        this.quizId = navParams.get('quizId');\r\n        this.courseId = navParams.get('courseId');\r\n    }\r\n\r\n    /**\r\n     * Component being initialized.\r\n     */\r\n    ngOnInit(): void {\r\n        this.fetchQuizData().finally(() => {\r\n            this.loaded = true;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Refresh the data.\r\n     *\r\n     * @param {any} refresher Refresher.\r\n     */\r\n    doRefresh(refresher: any): void {\r\n        this.refreshData().finally(() => {\r\n            refresher.complete();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get quiz data and attempt data.\r\n     *\r\n     * @return {Promise<void>} Promise resolved when done.\r\n     */\r\n    protected fetchQuizData(): Promise<void> {\r\n        return this.quizProvider.getQuizById(this.courseId, this.quizId).then((quizData) => {\r\n            this.quiz = quizData;\r\n            this.componentId = this.quiz.coursemodule;\r\n\r\n            return this.fetchAttempt();\r\n        }).catch((message) => {\r\n            this.domUtils.showErrorModalDefault(message, 'addon.mod_quiz.errorgetattempt', true);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get the attempt data.\r\n     *\r\n     * @return {Promise<void>} Promise resolved when done.\r\n     */\r\n    protected fetchAttempt(): Promise<void> {\r\n        const promises = [];\r\n        let options,\r\n            accessInfo;\r\n\r\n        // Get all the attempts and search the one we want.\r\n        promises.push(this.quizProvider.getUserAttempts(this.quizId).then((attempts) => {\r\n            for (let i = 0; i < attempts.length; i++) {\r\n                const attempt = attempts[i];\r\n                if (attempt.id == this.attemptId) {\r\n                    this.attempt = attempt;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!this.attempt) {\r\n                // Attempt not found, error.\r\n                return Promise.reject(null);\r\n            }\r\n\r\n            // Load flag to show if attempt is finished but not synced.\r\n            return this.quizProvider.loadFinishedOfflineData([this.attempt]);\r\n        }));\r\n\r\n        promises.push(this.quizProvider.getCombinedReviewOptions(this.quiz.id).then((opts) => {\r\n            options = opts;\r\n        }));\r\n\r\n        // Check if the user can review the attempt.\r\n        promises.push(this.quizProvider.getQuizAccessInformation(this.quiz.id).then((quizAccessInfo) => {\r\n            accessInfo = quizAccessInfo;\r\n\r\n            if (accessInfo.canreviewmyattempts) {\r\n                return this.quizProvider.getAttemptReview(this.attemptId, -1).catch(() => {\r\n                    // Error getting the review, assume the user cannot review the attempt.\r\n                    accessInfo.canreviewmyattempts = false;\r\n                });\r\n            }\r\n        }));\r\n\r\n        return Promise.all(promises).then(() => {\r\n\r\n            // Determine fields to show.\r\n            this.quizHelper.setQuizCalculatedData(this.quiz, options);\r\n            this.quiz.showReviewColumn = accessInfo.canreviewmyattempts;\r\n\r\n            // Get readable data for the attempt.\r\n            this.quizHelper.setAttemptCalculatedData(this.quiz, this.attempt, false);\r\n\r\n            // Check if the feedback should be displayed.\r\n            const grade = Number(this.attempt.rescaledGrade);\r\n            if (this.quiz.showFeedbackColumn && this.quizProvider.isAttemptFinished(this.attempt.state) &&\r\n                        options.someoptions.overallfeedback && !isNaN(grade)) {\r\n\r\n                // Feedback should be displayed, get the feedback for the grade.\r\n                return this.quizProvider.getFeedbackForGrade(this.quiz.id, grade).then((response) => {\r\n                    this.attempt.feedback = response.feedbacktext;\r\n                });\r\n            } else {\r\n                delete this.attempt.feedback;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Refresh the data.\r\n     *\r\n     * @return {Promise<void>} Promise resolved when done.\r\n     */\r\n    protected refreshData(): Promise<void> {\r\n        const promises = [];\r\n\r\n        promises.push(this.quizProvider.invalidateQuizData(this.courseId));\r\n        promises.push(this.quizProvider.invalidateUserAttemptsForUser(this.quizId));\r\n        promises.push(this.quizProvider.invalidateQuizAccessInformation(this.quizId));\r\n        promises.push(this.quizProvider.invalidateCombinedReviewOptionsForUser(this.quizId));\r\n        promises.push(this.quizProvider.invalidateAttemptReview(this.attemptId));\r\n\r\n        if (this.attempt && typeof this.attempt.feedback != 'undefined') {\r\n            promises.push(this.quizProvider.invalidateFeedback(this.quizId));\r\n        }\r\n\r\n        return Promise.all(promises).catch(() => {\r\n            // Ignore errors.\r\n        }).then(() => {\r\n            return this.fetchQuizData();\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/addon/mod/quiz/pages/attempt/attempt.ts"],"sourceRoot":""}