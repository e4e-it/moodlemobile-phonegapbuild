{"version":3,"sources":["../../src/core/login/pages/sites/sites.module.ts","../../src/core/login/pages/sites/sites.ts"],"names":[],"mappings":"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","file":"24.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CoreLoginSitesPage } from './sites';\r\nimport { CoreDirectivesModule } from '@directives/directives.module';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        CoreLoginSitesPage,\r\n    ],\r\n    imports: [\r\n        CoreDirectivesModule,\r\n        IonicPageModule.forChild(CoreLoginSitesPage),\r\n        TranslateModule.forChild()\r\n    ],\r\n})\r\nexport class CoreLoginSitesPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/login/pages/sites/sites.module.ts","// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component } from '@angular/core';\r\nimport { IonicPage } from 'ionic-angular';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { CoreLoggerProvider } from '@providers/logger';\r\nimport { CoreSitesProvider, CoreSiteBasicInfo } from '@providers/sites';\r\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\r\nimport { CoreTextUtilsProvider } from '@providers/utils/text';\r\nimport { AddonPushNotificationsProvider } from '@addon/pushnotifications/providers/pushnotifications';\r\nimport { CoreLoginHelperProvider } from '../../providers/helper';\r\n\r\n/**\r\n * Page that displays the list of stored sites.\r\n */\r\n@IonicPage({ segment: 'core-login-sites' })\r\n@Component({\r\n    selector: 'page-core-login-sites',\r\n    templateUrl: 'sites.html',\r\n})\r\nexport class CoreLoginSitesPage {\r\n    sites: CoreSiteBasicInfo[];\r\n    showDelete: boolean;\r\n    protected logger;\r\n\r\n    constructor(private domUtils: CoreDomUtilsProvider, private textUtils: CoreTextUtilsProvider,\r\n            private sitesProvider: CoreSitesProvider, private loginHelper: CoreLoginHelperProvider, logger: CoreLoggerProvider,\r\n            private translate: TranslateService, private pushNotificationsProvider: AddonPushNotificationsProvider) {\r\n        this.logger = logger.getInstance('CoreLoginSitesPage');\r\n    }\r\n\r\n    /**\r\n     * View loaded.\r\n     */\r\n    ionViewDidLoad(): void {\r\n        this.sitesProvider.getSortedSites().then((sites) => {\r\n            // Remove protocol from the url to show more url text.\r\n            this.sites = sites.map((site) => {\r\n                site.siteUrl = site.siteUrl.replace(/^https?:\\/\\//, '');\r\n                site.badge = 0;\r\n                this.pushNotificationsProvider.getSiteCounter(site.id).then((counter) => {\r\n                    site.badge = counter;\r\n                });\r\n\r\n                return site;\r\n            });\r\n\r\n            this.showDelete = false;\r\n        }).catch(() => {\r\n            // Shouldn't happen.\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Go to the page to add a site.\r\n     */\r\n    add(): void {\r\n        this.loginHelper.goToAddSite(false, true);\r\n    }\r\n\r\n    /**\r\n     * Delete a site.\r\n     *\r\n     * @param {Event} e Click event.\r\n     * @param {number} index Position of the site.\r\n     */\r\n    deleteSite(e: Event, index: number): void {\r\n        e.stopPropagation();\r\n\r\n        const site = this.sites[index],\r\n            siteName = site.siteName;\r\n\r\n        this.textUtils.formatText(siteName).then((siteName) => {\r\n            this.domUtils.showConfirm(this.translate.instant('core.login.confirmdeletesite', { sitename: siteName })).then(() => {\r\n                this.sitesProvider.deleteSite(site.id).then(() => {\r\n                    this.sites.splice(index, 1);\r\n                    this.showDelete = false;\r\n\r\n                    // If there are no sites left, go to add site.\r\n                    this.sitesProvider.hasSites().then((hasSites) => {\r\n                        if (!hasSites) {\r\n                            this.loginHelper.goToAddSite(true, true);\r\n                        }\r\n                    });\r\n                }).catch((error) => {\r\n                    this.logger.error('Error deleting site ' + site.id, error);\r\n                    this.domUtils.showErrorModalDefault(error, 'Delete site failed.');\r\n                    this.domUtils.showErrorModal('core.login.errordeletesite', true);\r\n                });\r\n            }).catch(() => {\r\n                // User cancelled, nothing to do.\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Login in a site.\r\n     *\r\n     * @param {string} siteId The site ID.\r\n     */\r\n    login(siteId: string): void {\r\n        const modal = this.domUtils.showModalLoading();\r\n\r\n        this.sitesProvider.loadSite(siteId).then(() => {\r\n            if (!this.loginHelper.isSiteLoggedOut()) {\r\n                return this.loginHelper.goToSiteInitialPage();\r\n            }\r\n        }).catch((error) => {\r\n            this.logger.error('Error loading site ' + siteId, error);\r\n            this.domUtils.showErrorModalDefault(error, 'Error loading site.');\r\n        }).finally(() => {\r\n            modal.dismiss();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Toggle delete.\r\n     */\r\n    toggleDelete(): void {\r\n        this.showDelete = !this.showDelete;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/login/pages/sites/sites.ts"],"sourceRoot":""}