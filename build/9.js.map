{"version":3,"sources":["../../src/core/user/pages/profile/profile.module.ts","../../src/core/user/pages/profile/profile.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CoreUserProfilePage } from './profile';\r\nimport { CoreDirectivesModule } from '@directives/directives.module';\r\nimport { CoreComponentsModule } from '@components/components.module';\r\n\r\n@NgModule({\r\n    declarations: [\r\n        CoreUserProfilePage,\r\n    ],\r\n    imports: [\r\n        CoreDirectivesModule,\r\n        CoreComponentsModule,\r\n        IonicPageModule.forChild(CoreUserProfilePage),\r\n        TranslateModule.forChild()\r\n    ],\r\n})\r\nexport class CoreUserProfilePageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/user/pages/profile/profile.module.ts","// (C) Copyright 2015 Martin Dougiamas\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\nimport { Component, Optional } from '@angular/core';\r\nimport { IonicPage, NavParams, NavController } from 'ionic-angular';\r\nimport { CoreUserProvider } from '../../providers/user';\r\nimport { CoreUserHelperProvider } from '../../providers/helper';\r\nimport { CoreDomUtilsProvider } from '@providers/utils/dom';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { CoreCoursesProvider } from '@core/courses/providers/courses';\r\nimport { CoreEventsProvider } from '@providers/events';\r\nimport { CoreSitesProvider } from '@providers/sites';\r\nimport { CoreMimetypeUtilsProvider } from '@providers/utils/mimetype';\r\nimport { CoreFileUploaderHelperProvider } from '@core/fileuploader/providers/helper';\r\nimport { CoreUserDelegate, CoreUserProfileHandlerData } from '../../providers/user-delegate';\r\nimport { CoreSplitViewComponent } from '@components/split-view/split-view';\r\n\r\n/**\r\n * Page that displays an user profile page.\r\n */\r\n@IonicPage({ segment: 'core-user-profile' })\r\n@Component({\r\n    selector: 'page-core-user-profile',\r\n    templateUrl: 'profile.html',\r\n})\r\nexport class CoreUserProfilePage {\r\n    protected courseId: number;\r\n    protected userId: number;\r\n    protected site;\r\n    protected obsProfileRefreshed: any;\r\n    protected subscription;\r\n\r\n    userLoaded = false;\r\n    isLoadingHandlers = false;\r\n    user: any;\r\n    title: string;\r\n    isDeleted = false;\r\n    canChangeProfilePicture = false;\r\n    actionHandlers: CoreUserProfileHandlerData[] = [];\r\n    newPageHandlers: CoreUserProfileHandlerData[] = [];\r\n    communicationHandlers: CoreUserProfileHandlerData[] = [];\r\n\r\n    constructor(navParams: NavParams, private userProvider: CoreUserProvider, private userHelper: CoreUserHelperProvider,\r\n            private domUtils: CoreDomUtilsProvider, private translate: TranslateService, private eventsProvider: CoreEventsProvider,\r\n            private coursesProvider: CoreCoursesProvider, private sitesProvider: CoreSitesProvider,\r\n            private mimetypeUtils: CoreMimetypeUtilsProvider, private fileUploaderHelper: CoreFileUploaderHelperProvider,\r\n            private userDelegate: CoreUserDelegate, private navCtrl: NavController,\r\n            @Optional() private svComponent: CoreSplitViewComponent) {\r\n        this.userId = navParams.get('userId');\r\n        this.courseId = navParams.get('courseId');\r\n\r\n        this.site = this.sitesProvider.getCurrentSite();\r\n\r\n        // Allow to change the profile image only in the app profile page.\r\n        this.canChangeProfilePicture =\r\n            (!this.courseId || this.courseId == this.site.getSiteHomeId()) &&\r\n            this.userId == this.site.getUserId() &&\r\n            this.site.canUploadFiles() &&\r\n            this.site.wsAvailable('core_user_update_picture') &&\r\n            !this.userProvider.isUpdatePictureDisabledInSite(this.site);\r\n\r\n        this.obsProfileRefreshed = eventsProvider.on(CoreUserProvider.PROFILE_REFRESHED, (data) => {\r\n            if (this.user && typeof data.user != 'undefined') {\r\n                this.user.email = data.user.email;\r\n                this.user.address = this.userHelper.formatAddress('', data.user.city, data.user.country);\r\n            }\r\n        }, sitesProvider.getCurrentSiteId());\r\n    }\r\n\r\n    /**\r\n     * View loaded.\r\n     */\r\n    ionViewDidLoad(): void {\r\n        this.fetchUser().then(() => {\r\n            return this.userProvider.logView(this.userId, this.courseId).catch((error) => {\r\n                this.isDeleted = error.errorcode === 'userdeleted';\r\n            });\r\n        }).finally(() => {\r\n            this.userLoaded = true;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Fetches the user and updates the view.\r\n     */\r\n    fetchUser(): Promise<any> {\r\n        return this.userProvider.getProfile(this.userId, this.courseId).then((user) => {\r\n\r\n            user.address = this.userHelper.formatAddress('', user.city, user.country);\r\n            user.roles = this.userHelper.formatRoleList(user.roles);\r\n\r\n            this.user = user;\r\n            this.title = user.fullname;\r\n\r\n            this.subscription = this.userDelegate.getProfileHandlersFor(user, this.courseId).subscribe((handlers) => {\r\n                this.actionHandlers = [];\r\n                this.newPageHandlers = [];\r\n                this.communicationHandlers = [];\r\n                handlers.forEach((handler) => {\r\n                    switch (handler.type) {\r\n                        case CoreUserDelegate.TYPE_COMMUNICATION:\r\n                            this.communicationHandlers.push(handler.data);\r\n                            break;\r\n                        case CoreUserDelegate.TYPE_ACTION:\r\n                            this.actionHandlers.push(handler.data);\r\n                            break;\r\n                        case CoreUserDelegate.TYPE_NEW_PAGE:\r\n                        default:\r\n                            this.newPageHandlers.push(handler.data);\r\n                            break;\r\n                    }\r\n                });\r\n\r\n                this.isLoadingHandlers = !this.userDelegate.areHandlersLoaded(user.id);\r\n            });\r\n\r\n        }).catch((error) => {\r\n            // Error is null for deleted users, do not show the modal.\r\n            if (error) {\r\n                this.domUtils.showErrorModal(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Opens dialog to change profile picture.\r\n     */\r\n    changeProfilePicture(): Promise<any> {\r\n        const maxSize = -1,\r\n            title = this.translate.instant('core.user.newpicture'),\r\n            mimetypes = this.mimetypeUtils.getGroupMimeInfo('image', 'mimetypes');\r\n\r\n        return this.fileUploaderHelper.selectAndUploadFile(maxSize, title, mimetypes).then((result) => {\r\n            const modal = this.domUtils.showModalLoading('core.sending', true);\r\n\r\n            return this.userProvider.changeProfilePicture(result.itemid, this.userId).then((profileImageURL) => {\r\n                this.eventsProvider.trigger(CoreUserProvider.PROFILE_PICTURE_UPDATED, {\r\n                    userId: this.userId,\r\n                    picture: profileImageURL\r\n                });\r\n                this.sitesProvider.updateSiteInfo(this.site.getId());\r\n                this.refreshUser();\r\n            }).finally(() => {\r\n                modal.dismiss();\r\n            });\r\n        }).catch((message) => {\r\n            if (message) {\r\n                this.domUtils.showErrorModal(message);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Refresh the user.\r\n     *\r\n     * @param {any} refresher Refresher.\r\n     */\r\n    refreshUser(refresher?: any): void {\r\n        const promises = [];\r\n\r\n        promises.push(this.userProvider.invalidateUserCache(this.userId));\r\n        promises.push(this.coursesProvider.invalidateUserNavigationOptions());\r\n        promises.push(this.coursesProvider.invalidateUserAdministrationOptions());\r\n\r\n        Promise.all(promises).finally(() => {\r\n            this.fetchUser().finally(() => {\r\n                this.eventsProvider.trigger(CoreUserProvider.PROFILE_REFRESHED, {\r\n                    courseId: this.courseId,\r\n                    userId: this.userId,\r\n                    user: this.user\r\n                }, this.site.getId());\r\n                refresher && refresher.complete();\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Open the page with the user details.\r\n     */\r\n    openUserDetails(): void {\r\n        // Decide which navCtrl to use. If this page is inside a split view, use the split view's master nav.\r\n        const navCtrl = this.svComponent ? this.svComponent.getMasterNav() : this.navCtrl;\r\n        navCtrl.push('CoreUserAboutPage', {courseId: this.courseId, userId: this.userId});\r\n    }\r\n\r\n    /**\r\n     * A handler was clicked.\r\n     *\r\n     * @param {Event} event Click event.\r\n     * @param {CoreUserProfileHandlerData} handler Handler that was clicked.\r\n     */\r\n    handlerClicked(event: Event, handler: CoreUserProfileHandlerData): void {\r\n        // Decide which navCtrl to use. If this page is inside a split view, use the split view's master nav.\r\n        const navCtrl = this.svComponent ? this.svComponent.getMasterNav() : this.navCtrl;\r\n        handler.action(event, navCtrl, this.user, this.courseId);\r\n    }\r\n\r\n    /**\r\n     * Page destroyed.\r\n     */\r\n    ngOnDestroy(): void {\r\n        this.subscription && this.subscription.unsubscribe();\r\n        this.obsProfileRefreshed && this.obsProfileRefreshed.off();\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/user/pages/profile/profile.ts"],"sourceRoot":""}